# Peak Vista - 3D地形眺望ビューア

国土地理院の標高マップデータ（DEM10B）を使用して、指定した地点からの眺めを高品質な3Dで再現するウェブアプリケーションです。

![Status](https://img.shields.io/badge/status-in%20development-yellow)
![License](https://img.shields.io/badge/license-MIT-green)

## プロジェクト概要

### 目的
指定した座標（緯度・経度）からの風景を3D地形として表示し、実際の地形を立体的に確認できるツールです。

**使用例:**
- 登山計画時の視界確認
- 土地の地形把握
- 地形の3D可視化研究

### 主な特徴
- 🗻 **高品質な3D地形表示** - WebGL + Three.js による最新ブラウザ対応
- ⚡ **高速メッシュ生成** - Rust+WASM による高速計算
- 💾 **インテリジェントキャッシング** - IndexedDB による自動キャッシュ（フェーズ2で実装）
- 📱 **レスポンシブ設計** - デスクトップ・スマートフォン両対応
- 🔍 **複数LODレベル** - 距離に応じた詳細度自動調整

---

## セットアップ

### 必要な環境
- **Node.js**: v18.0 以上 ([ダウンロード](https://nodejs.org/))
- **Rust**: v1.70 以上 ([インストール](https://www.rust-lang.org/))
- **wasm-pack**: v0.12 以上

### インストール手順

#### 1. リポジトリをクローン
```bash
git clone https://github.com/muraoka/peak-vista.git
cd peak-vista
```

#### 2. Node.js 依存関係をインストール
```bash
npm install
```

#### 3. wasm-pack のインストール（初回のみ）
```bash
curl https://rustwasm.github.io/wasm-pack/installer/init.sh -sSf | sh
```

または、Cargo を使う場合：
```bash
cargo install wasm-pack
```

#### 4. WASM モジュールをビルド
```bash
npm run build:wasm
```

このコマンドで：
- Rust コードが WebAssembly にコンパイル
- 自動生成されたバインディング (`src/wasm/` に配置)

---

## 実行方法

### 開発サーバーの起動（推奨）

開発中は以下のコマンドで、ホットリロード対応の開発サーバーを起動します：

```bash
npm run dev
```

**出力例:**
```
  VITE v5.4.21  ready in 278 ms

  ➜  Local:   http://localhost:3000/peak-vista/
  ➜  Network: use --host to expose
```

#### ブラウザで開く
[http://localhost:3000/peak-vista/](http://localhost:3000/peak-vista/) にアクセス

### 本番ビルド

プロダクション用の最適化されたビルドを作成：

```bash
npm run build
```

出力は `dist/` ディレクトリに生成されます。

### ビルド結果をローカルプレビュー

```bash
npm run preview
```

---

## 使い方

### アプリケーション初期画面 - マップビュー

アプリケーション起動時は、**日本全体の2D地図**が表示されます。

#### マップビュー操作

| 操作 | 説明 |
|-----|------|
| **マウスホイール** | ズーム（レベル5-15）|
| **左ドラッグ** | マップのパン（移動）|
| **マップクリック** | その地点から3Dビューを表示 |

**処理フロー:**
```
1. マップ上の任意の場所をクリック
   ↓
2. その地点の標高データを自動取得
   ↓
3. 3D地形ビューに自動切り替え
   ↓
4. その場所からの風景が表示される
```

### 3D地形ビュー - 眺望表示

クリックした地点から見た景色が3Dで表示されます。

#### 3D地形ビューの操作

| 操作 | 動作 |
|-----|------|
| **マウスドラッグ** | カメラ回転（視点変更）|
| **マウスホイール** | ズーム（カメラ距離調整）|
| **矢印キー** | カメラパン（移動）|
| **W/A/S/D** | カメラ移動 |
| **+/- キー** | ズーム調整 |

#### 3D表示パネル（左側）

| セクション | 説明 |
|-----------|------|
| **Location** | 緯度・経度・視角・距離を手動設定（Form利用） |
| **Camera Info** | 現在のカメラ距離・高さ・方角・読み込み済みタイル数 |
| **Preset Locations** | 富士山など有名地点のワンクリック読み込み |
| **Actions** | キャッシュクリア、ビュー設定保存機能 |
| **Performance** | FPS、フレームタイム、メモリ使用量表示 |
| **Keyboard Controls** | 操作説明 |

#### プリセット地点

以下のボタンで有名地点へジャンプできます：
- 🗻 **富士山** - 35.360556°N, 138.727778°E
- ⛰️ **北アルプス** - 36.104611°N, 137.971111°E
- 🏔️ **中央アルプス** - 35.957889°N, 137.468417°E
- 🏯 **京都** - 34.746236°N, 135.729816°E

---

## 開発ガイド

### WASM 部分を修正した場合

```bash
# WASM を再ビルド
npm run build:wasm

# 自動的にホットリロードされます（npm run dev が起動している場合）
```

### JavaScript のみを修正した場合

```bash
# 自動的にホットリロード（Vite の HMR）
# npm run dev が起動していれば、保存時に自動更新
```

---

## ライセンス

MIT License - 詳細は [LICENSE](LICENSE) を参照
